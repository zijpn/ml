"use strict";function changeLr(){lr=+d3.select("#lr").node().value}function changeTheta0(){theta0=+d3.select("#theta0").node().value}function changeTheta1(){theta1=+d3.select("#theta1").node().value}function getCoord(t){return t.map(function(t){return{x:t,y:theta1*t+theta0}})}function updateGraph(){var t=600,e=600,a=d3.scale.linear().domain(d3.extent(data,function(t){return t.values.x})).range([0,t]).nice(),r=d3.scale.linear().domain(d3.extent(data,function(t){return t.values.y})).range([e,0]).nice();svg.select("g.x.axis").empty()&&(svg.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")"),svg.append("g").attr("class","y axis")),svg.select("g.x.axis").call(d3.svg.axis().scale(a).orient("bottom")),svg.select("g.y.axis").call(d3.svg.axis().scale(r).orient("left"));var n=svg.selectAll("circle").data(data);n.enter().append("circle").attr("r",7).style("fill","steelblue"),n.attr("cx",function(t){return a(t.values.x)}).attr("cy",function(t){return r(t.values.y)}).on("mouseover",function(t){var e=theta1*t.values.x+theta0,n=svg.append("g").attr("class","pointer");n.append("line").attr("marker-end","url(#arrow)").style("stroke","steelblue").style("stroke-width",2).attr("x1",a(t.values.x)).attr("y1",r(t.values.y)).attr("x2",a(t.values.x)).attr("y2",r(e)),n.append("text").attr("text-anchor","middle").attr("x",a(t.values.x)).attr("y",r(t.values.y)+(e>t.values.y?25:-15)).text(""+d3.round(t.values.y-e,4))}).on("mouseout",function(){svg.select(".pointer").remove()}),n.exit().remove();var d=d3.svg.line().x(function(t){return a(t.x)}).y(function(t){return r(t.y)}),s=svg.selectAll("path.reg").data([getCoord(a.ticks(100))]);s.enter().append("path").attr("class","reg"),s.attr("d",d),s.exit().remove()}function update(t){d3.select("#values").html("Iteration = "+iteration+(converged?" (converged)":diverged?" (diverged)":"")+"<br/>\\(\\theta_0 = "+d3.round(theta0,4)+"\\)<br/>\\(\\theta_1 = "+d3.round(theta1,4)+"\\)<br/>\\(SSE = "+d3.round(t,2)+"\\)<br/>"),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"values"]),updateGraph()}function init(){changeLr(),changeTheta0(),changeTheta1(),converged=!1,diverged=!1,iteration=0;var t=d3.sum(data,function(t){return Math.pow(t.values.y-(theta1*t.values.x+theta0),2)});update(t),d3.select("#step").attr("disabled",null),d3.select("#run").attr("disabled",null)}function gstep(){if(converged||diverged)return d3.select("#step").attr("disabled","true"),void d3.select("#run").attr("disabled","true");iteration++;var t=d3.sum(data,function(t){return t.values.y-(theta1*t.values.x+theta0)}),e=theta0+2*lr*t,a=d3.sum(data,function(t){return(t.values.y-(theta1*t.values.x+theta0))*t.values.x}),r=theta1+2*lr*a,n=Math.abs(e-theta0),d=Math.abs(r-theta1),s=1e-6;s>n&&s>d&&(converged=!0);var i=1e6;(n>i||d>i)&&(diverged=!0),theta0=e,theta1=r;var l=d3.sum(data,function(t){return Math.pow(t.values.y-(theta1*t.values.x+theta0),2)});update(l)}function grun(){for(;!converged&&!diverged;)gstep();gstep()}function changeDs(){var t=document.getElementById("dataset").value;"data1"===t?data=dataset1:"data2"===t&&(data=dataset2),init()}var id=1,converged,diverged,iteration,lr,theta0,theta1,svg,data,dataset1=[{id:id++,values:{x:1,y:1}},{id:id++,values:{x:1.5,y:2}},{id:id++,values:{x:0,y:.5}},{id:id++,values:{x:10,y:9.5}},{id:id++,values:{x:8,y:10}},{id:id++,values:{x:5,y:3}}],dataset2=[{id:id++,values:{x:0,y:0}},{id:id++,values:{x:1,y:1}},{id:id++,values:{x:2,y:2}},{id:id++,values:{x:3,y:3}},{id:id++,values:{x:4,y:4}},{id:id++,values:{x:10,y:10}}];!function(){data=dataset1,svg=d3.select("#graph").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 700 700").append("g").attr("transform","translate(35,35)"),svg.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",10).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("fill","steelblue").style("stroke","none").attr("d","M0,-5L10,0L0,5"),init()}();